"use strict";(self.webpackChunkrunar_docs=self.webpackChunkrunar_docs||[]).push([[2742],{5216:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"services/macros","title":"Services in Runar","description":"Services are the core building blocks of Runar applications. They provide functionality that can be called by other services or external clients, and they can communicate with each other through events.","source":"@site/docs/services/macros.md","sourceDirName":"services","slug":"/services/macros","permalink":"/rust-docs/docs/services/macros","draft":false,"unlisted":false,"editUrl":"https://github.com/runar-labs/runar-rust/tree/main/rust-docs/markdown/docs/services/macros.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Installing Runar","permalink":"/rust-docs/docs/getting-started/installation"},"next":{"title":"Example Service Implementation","permalink":"/rust-docs/docs/services/example-service"}}');var i=n(4848),c=n(8453);const l={},t="Services in Runar",a={},d=[{value:"What is a Service?",id:"what-is-a-service",level:2},{value:"Quick Example",id:"quick-example",level:2},{value:"Service Macros",id:"service-macros",level:2},{value:"<code>#[service]</code> - Service Definition",id:"service---service-definition",level:3},{value:"<code>#[action]</code> - Expose Methods",id:"action---expose-methods",level:3},{value:"<code>#[publish]</code> - Event Publishing",id:"publish---event-publishing",level:3},{value:"<code>#[subscribe]</code> - Event Handling",id:"subscribe---event-handling",level:3},{value:"Service Communication Patterns",id:"service-communication-patterns",level:2},{value:"1. Request/Response",id:"1-requestresponse",level:3},{value:"2. Event-Driven",id:"2-event-driven",level:3},{value:"Service Lifecycle",id:"service-lifecycle",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Service Design",id:"1-service-design",level:3},{value:"2. Error Handling",id:"2-error-handling",level:3},{value:"3. Event Design",id:"3-event-design",level:3},{value:"4. Performance",id:"4-performance",level:3},{value:"Migration from Legacy APIs",id:"migration-from-legacy-apis",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"services-in-runar",children:"Services in Runar"})}),"\n",(0,i.jsx)(s.p,{children:"Services are the core building blocks of Runar applications. They provide functionality that can be called by other services or external clients, and they can communicate with each other through events."}),"\n",(0,i.jsx)(s.h2,{id:"what-is-a-service",children:"What is a Service?"}),"\n",(0,i.jsx)(s.p,{children:"A service in Runar is a Rust struct that:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Exposes actions"})," that can be called remotely"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Publishes events"})," to notify other services"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Subscribes to events"})," from other services"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Manages its own state"})," and lifecycle"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Think of services as microservices that can run locally or be distributed across a network of nodes."}),"\n",(0,i.jsx)(s.h2,{id:"quick-example",children:"Quick Example"}),"\n",(0,i.jsx)(s.p,{children:"Here's a simple service that provides math operations:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:'use runar_macros::{service, action, publish, subscribe};\nuse anyhow::Result;\n\n#[service(name = "math", path = "math")]\npub struct MathService;\n\n#[service_impl]\nimpl MathService {\n    #[action]\n    pub fn add(&self, a: f64, b: f64) -> Result<f64> {\n        let result = a + b;\n        \n        // Publish an event when addition completes\n        self.publish_math_operation("add", a, b, result)?;\n        \n        Ok(result)\n    }\n    \n    #[action]\n    pub fn multiply(&self, a: f64, b: f64) -> Result<f64> {\n        let result = a * b;\n        self.publish_math_operation("multiply", a, b, result)?;\n        Ok(result)\n    }\n    \n    #[publish(topic = "math/operation")]\n    fn publish_math_operation(&self, operation: &str, a: f64, b: f64, result: f64) -> Result<()> {\n        // This method automatically publishes events\n        Ok(())\n    }\n}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"service-macros",children:"Service Macros"}),"\n",(0,i.jsx)(s.p,{children:"Runar provides several macros to make service development simple and declarative:"}),"\n",(0,i.jsxs)(s.h3,{id:"service---service-definition",children:[(0,i.jsx)(s.code,{children:"#[service]"})," - Service Definition"]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"#[service]"})," macro defines a service and automatically implements the ",(0,i.jsx)(s.code,{children:"AbstractService"})," trait:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:'#[service(name = "user_service", path = "user_service")]\npub struct UserService {\n    users: HashMap<String, User>,\n}\n\n#[service_impl]\nimpl UserService {\n    // Actions and event handlers go here\n}\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Service Attributes:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"name"}),": The service name (used in routing)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"version"}),": Optional version string"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"description"}),": Optional service description"]}),"\n"]}),"\n",(0,i.jsxs)(s.h3,{id:"action---expose-methods",children:[(0,i.jsx)(s.code,{children:"#[action]"})," - Expose Methods"]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"#[action]"})," macro makes methods callable from other services or clients:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:"#[action]\npub fn create_user(&self, username: String, email: String) -> Result<String> {\n    // Method logic here\n    Ok(user_id)\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Action Features:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Type Safety"}),": Parameters and return types are preserved"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Error Handling"}),": ",(0,i.jsx)(s.code,{children:"Result<T>"})," automatically becomes error responses"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Async Support"}),": Methods can be ",(0,i.jsx)(s.code,{children:"async"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Context Access"}),": Automatically receives ",(0,i.jsx)(s.code,{children:"RequestContext"})," if needed"]}),"\n"]}),"\n",(0,i.jsxs)(s.h3,{id:"publish---event-publishing",children:[(0,i.jsx)(s.code,{children:"#[publish]"})," - Event Publishing"]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"#[publish]"})," macro automatically publishes events when methods are called:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:'#[publish(topic = "user/created")]\npub fn create_user(&self, username: String, email: String) -> Result<String> {\n    let user_id = self.internal_create_user(username, email)?;\n    Ok(user_id) // This automatically publishes the event\n}\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Publishing Features:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Automatic"}),": Events are published when methods return ",(0,i.jsx)(s.code,{children:"Ok"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Topic Routing"}),": Events are sent to the specified topic"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Data Serialization"}),": Return values are automatically serialized"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Network Distribution"}),": Events can be distributed across the network"]}),"\n"]}),"\n",(0,i.jsxs)(s.h3,{id:"subscribe---event-handling",children:[(0,i.jsx)(s.code,{children:"#[subscribe]"})," - Event Handling"]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"#[subscribe]"})," macro sets up event handlers:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:'#[subscribe(topic = "user/created")]\nasync fn on_user_created(&self, user_data: ArcValue) -> Result<()> {\n    // Handle the user creation event\n    let user: User = user_data.as_type()?;\n    self.notify_admin(&user).await?;\n    Ok(())\n}\n'})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Subscription Features:"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Topic Matching"}),": Supports wildcards like ",(0,i.jsx)(s.code,{children:"user/*"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Async Support"}),": Handlers can be async"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Type Safety"}),": Events are automatically deserialized"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Multiple Handlers"}),": One service can subscribe to many topics"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"service-communication-patterns",children:"Service Communication Patterns"}),"\n",(0,i.jsx)(s.h3,{id:"1-requestresponse",children:"1. Request/Response"}),"\n",(0,i.jsx)(s.p,{children:"Services can call each other directly:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:'// Service A calls Service B\nlet result: f64 = node.request("math/add", Some(ArcValue::new_map(hmap! {\n    "a" => 10.0,\n    "b" => 5.0\n}))).await?;\n'})}),"\n",(0,i.jsx)(s.h3,{id:"2-event-driven",children:"2. Event-Driven"}),"\n",(0,i.jsx)(s.p,{children:"Services communicate through events:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:'// Service A publishes an event\n#[publish(topic = "order/created")]\npub fn create_order(&self, order: Order) -> Result<String> {\n    // Order creation logic\n    Ok(order_id)\n}\n\n// Service B subscribes to the event\n#[subscribe(topic = "order/created")]\nasync fn on_order_created(&self, order_data: ArcValue) -> Result<()> {\n    let order: Order = order_data.as_type()?;\n    self.send_notification(&order).await?;\n    Ok(())\n}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"service-lifecycle",children:"Service Lifecycle"}),"\n",(0,i.jsx)(s.p,{children:"Services go through several lifecycle phases:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Creation"}),": Service struct is instantiated"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Initialization"}),": ",(0,i.jsx)(s.code,{children:"#[service_impl]"})," methods are called"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Registration"}),": Service is registered with the node"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Startup"}),": Service begins processing requests and events"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Running"}),": Service is active and handling operations"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Shutdown"}),": Service stops gracefully"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(s.h3,{id:"1-service-design",children:"1. Service Design"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Single Responsibility"}),": Each service should have one clear purpose"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Stateless"}),": Services should be stateless when possible"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Idempotent"}),": Actions should be safe to retry"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Versioning"}),": Use service versions for breaking changes"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"2-error-handling",children:"2. Error Handling"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-rust",children:'#[action]\npub fn divide(&self, a: f64, b: f64) -> Result<f64> {\n    if b == 0.0 {\n        anyhow::bail!("Cannot divide by zero");\n    }\n    Ok(a / b)\n}\n'})}),"\n",(0,i.jsx)(s.h3,{id:"3-event-design",children:"3. Event Design"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Use Descriptive Topics"}),": ",(0,i.jsx)(s.code,{children:"user/created"})," not just ",(0,i.jsx)(s.code,{children:"event1"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Include Relevant Data"}),": Events should contain useful information"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Handle Failures"}),": Event handlers should be resilient"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"4-performance",children:"4. Performance"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Async Operations"}),": Use async for I/O operations"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Batch Processing"}),": Group related operations when possible"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Caching"}),": Cache frequently accessed data"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"migration-from-legacy-apis",children:"Migration from Legacy APIs"}),"\n",(0,i.jsxs)(s.p,{children:["Older docs & examples used types like ",(0,i.jsx)(s.code,{children:"ValueType"}),", manual ",(0,i.jsx)(s.code,{children:"ServiceRequest/Response"}),", and custom ",(0,i.jsx)(s.code,{children:"handle_request"})," functions. All of these are now obsolete:"]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Legacy Concept"}),(0,i.jsx)(s.th,{children:"Modern Replacement"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ValueType"})}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"ArcValue"})," (zero-copy, thread-safe wrapper)"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ServiceRequest/Response"})}),(0,i.jsx)(s.td,{children:"Direct parameters + return values"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["Manual ",(0,i.jsx)(s.code,{children:"handle_request"})]}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"#[action]"})," macro"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Manual subscription setup"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"#[subscribe]"})," macro"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Manual service registration"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"#[service]"})," macro"]})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Try the Example"}),": See ",(0,i.jsx)(s.a,{href:"/rust-docs/docs/services/example-service",children:"Example Service"})," for a complete working example"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Learn About Events"}),": Understand ",(0,i.jsx)(s.a,{href:"#event-driven",children:"Event Publishing and Subscriptions"})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Add Encryption"}),": Learn about ",(0,i.jsx)(s.a,{href:"../features/keys-management",children:"Key Management"})," and ",(0,i.jsx)(s.a,{href:"../features/encryption-schema",children:"Envelope Encryption"})]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);